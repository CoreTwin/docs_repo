[Домой](../README.md) | [Назад](../content/Description_for_agents.md)

# Архитектура CoreTwin Platform

## Обзор системы

CoreTwin Platform представляет собой модульную систему для создания цифрового двойника организации, построенную на принципах микросервисной архитектуры.

## Архитектурные принципы

### 1. Модульность
- Четкое разделение на backend и frontend
- Независимые сервисы по доменам
- Слабая связанность между компонентами

### 2. Масштабируемость
- Горизонтальное масштабирование сервисов
- Кеширование с Redis
- Асинхронная обработка с Celery

### 3. Безопасность
- JWT аутентификация
- RBAC авторизация
- Валидация данных на всех уровнях

## Компоненты системы

### Backend (Python/FastAPI)
```
backend/
├── app/                    # Основное приложение
│   ├── api/               # REST API endpoints
│   ├── models/            # SQLAlchemy модели
│   ├── schemas/           # Pydantic схемы
│   └── dependencies.py    # Зависимости FastAPI
├── services/              # Бизнес-логика
│   ├── auth/             # Аутентификация
│   └── logging/          # Логирование
└── tests/                # Тесты
```

### Frontend (React/TypeScript)
```
frontend/
├── src/
│   ├── components/       # React компоненты
│   ├── pages/           # Страницы приложения
│   ├── services/        # API клиенты
│   ├── store/           # Состояние приложения
│   └── types/           # TypeScript типы
```

### База данных
- **PostgreSQL** - основная база данных
- **Redis** - кеширование и сессии
- **ClickHouse** - аналитика (планируется)

## Потоки данных

### Аутентификация
1. Пользователь отправляет credentials
2. Backend проверяет данные
3. Генерируется JWT токен
4. Токен используется для авторизации запросов

### API запросы
1. Frontend отправляет HTTP запрос
2. Middleware проверяет авторизацию
3. Валидация данных через Pydantic
4. Обработка бизнес-логики
5. Возврат ответа в JSON формате

## Безопасность

### Аутентификация
- JWT токены с коротким временем жизни
- Refresh токены для обновления
- Хеширование паролей с bcrypt

### Авторизация
- Role-Based Access Control (RBAC)
- Проверка прав на уровне API
- Изоляция данных по компаниям

### Валидация
- Pydantic схемы для входящих данных
- SQLAlchemy модели с ограничениями
- Санитизация пользовательского ввода

## Мониторинг и логирование

### Структурированное логирование
- JSON формат логов
- Категоризация по типам ошибок
- Ротация файлов логов
- Фильтрация чувствительных данных

### Метрики
- Время ответа API
- Количество запросов
- Ошибки и исключения
- Использование ресурсов

## Развертывание

### Контейнеризация
- Docker контейнеры для всех сервисов
- Docker Compose для локальной разработки
- Kubernetes для продакшена

### CI/CD
- GitHub Actions для автоматизации
- Автоматические тесты
- Деплой документации
- Security scanning

## Интеграции

### Model Context Protocol (MCP)
- Интеграция с ИИ-сервисами
- Обмен контекстом между системами
- Стандартизированный протокол

### Внешние API
- Интеграция с HR системами
- Синхронизация справочников
- Экспорт/импорт данных

## Производительность

### Кеширование
- Redis для сессий пользователей
- Кеширование справочников
- Кеширование результатов запросов

### Оптимизация БД
- Индексы на часто используемых полях
- Пагинация для больших списков
- Ленивая загрузка связанных данных

## Будущие улучшения

### Микросервисы
- Выделение отдельных сервисов по доменам
- Service mesh для коммуникации
- Распределенная трассировка

### Аналитика
- Интеграция с ClickHouse
- Дашборды и отчеты
- Машинное обучение для рекомендаций
